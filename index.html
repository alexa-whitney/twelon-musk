<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Elon Musk's Tweets Line Graph</title>
    <style>
      .tooltip {
        position: absolute;
        pointer-events: none;
        background: #fff;
        border: 1px solid #ccc;
        padding: 10px;
        border-radius: 10px;
        max-width: 300px;
        font-family: Arial, sans-serif;
      }
    </style>
  </head>
  <body>
    <svg id="linegraph" width="800" height="400"></svg>

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>
      // Load and preprocess your data here
      d3.csv("elonmusk.csv").then((data) => {
        // Set up the SVG container and dimensions
        const margin = { top: 20, right: 20, bottom: 40, left: 40 };
        const width = 800 - margin.left - margin.right;
        const height = 400 - margin.top - margin.bottom;

        // Parse the date/time values
        const parseDate = d3.timeParse("%Y-%m-%d %H:%M:%S%Z");
        data.forEach((d) => {
          d.Datetime = parseDate(d.Datetime);
        });

        // Group the tweets by date
        const tweetCounts = d3.rollup(
          data,
          (v) => ({ count: v.length, texts: v.map((d) => d.Text) }),
          (d) => d3.timeDay(d.Datetime)
        );

        // Convert the grouped data to an array of objects
        const tweetData = Array.from(tweetCounts, ([date, value]) => ({
          date,
          count: value.count,
          text: value.texts.join("\n"),
        }));

        // Set up the SVG element
        const svg = d3
          .select("#linegraph")
          .append("g")
          .attr("transform", `translate(${margin.left}, ${margin.top})`);

        // Define the scales for x and y axes
        const xScale = d3
          .scaleTime()
          .domain(d3.extent(tweetData, (d) => d.date))
          .range([0, width]);

        const yScale = d3
          .scaleLinear()
          .domain([0, d3.max(tweetData, (d) => d.count)])
          .range([height, 0]);

        // Define the line generator
        const line = d3
          .line()
          .x((d) => xScale(d.date))
          .y((d) => yScale(d.count));

        // Add the line path
        svg
          .append("path")
          .datum(tweetData)
          .attr("fill", "none")
          .attr("stroke", "steelblue")
          .attr("stroke-width", 1.5)
          .attr("d", line);

        // Add circles to represent each tweet count
        const circles = svg
          .selectAll("circle")
          .data(tweetData)
          .join("circle")
          .attr("cx", (d) => xScale(d.date))
          .attr("cy", (d) => yScale(d.count))
          .attr("r", 2)
          .attr("fill", "steelblue")
          .attr("opacity", 0.8)
          .on("mouseover", showTooltip)
          .on("mouseout", hideTooltip);
        // Define the tooltip
        const tooltip = d3
          .select("body")
          .append("div")
          .attr("class", "tooltip")
          .style("opacity", 0);

        function showTooltip(event, d) {
          tooltip
            .style("opacity", 1)
            .style("left", event.pageX + 10 + "px")
            .style("top", event.pageY + 10 + "px").html(`
                <b>Date/Time:</b> ${d.date}<br>
                <b>Tweet Count:</b> ${d.count}<br>
                <b>Tweet Text:</b> <br>
                ${d.text
                  .split("\n")
                  .map((text) => `<p>${text}</p>`)
                  .join("")}
              `); // Each tweet is put into a separate paragraph
        }

        function hideTooltip() {
          tooltip.style("opacity", 0);
        }

        // Add x-axis
        const xAxis = d3.axisBottom(xScale);
        svg
          .append("g")
          .attr("transform", `translate(0, ${height})`)
          .call(xAxis);

        // Add y-axis
        const yAxis = d3.axisLeft(yScale);
        svg.append("g").call(yAxis);

        // Add axis labels and title
        svg
          .append("text")
          .attr("x", width / 2)
          .attr("y", height + margin.bottom)
          .attr("text-anchor", "middle")
          .text("Date/Time");

        svg
          .append("text")
          .attr("transform", "rotate(-90)")
          .attr("x", -height / 2)
          .attr("y", -margin.left)
          .attr("dy", "1em")
          .attr("text-anchor", "middle")
          .text("Tweet Count");

        svg
          .append("text")
          .attr("x", width / 2)
          .attr("y", -margin.top)
          .attr("text-anchor", "middle")
          .style("font-size", "16px")
          .text("Elon Musk's Tweets Line Graph");
      });
    </script>
  </body>
</html>
